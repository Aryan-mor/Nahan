import{c as I,r as n,w as q,j as e,A as G,M as K,X as Z}from"./index-QZBt83e5.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],te=I("grip-vertical",ee);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]],re=I("minimize-2",ne),se=()=>{const[c,R]=n.useState(()=>{if(typeof navigator<"u"&&navigator.webdriver)return!1;const t=localStorage.getItem("nahan_perf_hud_visible");return localStorage.getItem("nahan_force_perf_hud")==="true"?!0:t!==null?t==="true":!1});n.useEffect(()=>{localStorage.setItem("nahan_perf_hud_visible",String(c))},[c]);const[o,z]=n.useState(()=>localStorage.getItem("nahan_perf_hud_mode")==="compact"?"compact":"full"),[l,T]=n.useState(()=>{const t=localStorage.getItem("nahan_perf_hud_pos");if(t)try{return JSON.parse(t)}catch{}return{y:100,side:"right"}}),[a,b]=n.useState(!1),m=n.useRef({x:0,y:0}),g=n.useRef(null),d=n.useRef(null),[y,D]=n.useState(0),S=n.useRef(Date.now()),[h,A]=n.useState(60),v=n.useRef(0),_=n.useRef(Date.now()),[p,C]=n.useState({storageQueueLength:0,processingQueueLength:0,activeTasks:0}),[j,H]=n.useState(0);n.useEffect(()=>{localStorage.setItem("nahan_perf_hud_mode",o)},[o]),n.useEffect(()=>{localStorage.setItem("nahan_perf_hud_pos",JSON.stringify(l))},[l]),n.useEffect(()=>{if(!c)return;const t=setInterval(()=>{const r=Date.now(),s=r-S.current,u=Math.max(0,s-500);D(u),S.current=r},500);return()=>clearInterval(t)},[c]),n.useEffect(()=>{if(!c)return;const t=setInterval(()=>{try{C(q.getQueueStats());const r=performance;if(r.memory){const s=r.memory.usedJSHeapSize;H(Math.round(s/1024/1024))}}catch(r){console.error("PerfHUD Error:",r)}},500);return()=>clearInterval(t)},[c]),n.useEffect(()=>{if(!c)return;let t;const r=()=>{v.current++;const s=Date.now();s-_.current>=1e3&&(A(v.current),v.current=0,_.current=s),t=requestAnimationFrame(r)};return t=requestAnimationFrame(r),()=>cancelAnimationFrame(t)},[c]);const k=(t,r)=>{d.current&&(m.current={x:t,y:r},g.current=d.current.getBoundingClientRect(),b(!0))},L=(t,r)=>{if(!a||!d.current||!g.current)return;const s=t-m.current.x,u=r-m.current.y,i=g.current,f=window.innerWidth,P=window.innerHeight,N=-i.left+5,$=f-i.right-5,U=-i.top+5,V=P-i.bottom-5,J=Math.max(N,Math.min($,s)),O=Math.max(U,Math.min(V,u));d.current.style.transform=`translate3d(${J}px, ${O}px, 0)`},M=()=>{if(!a||!d.current||!g.current)return;b(!1);const t=d.current.getBoundingClientRect(),r=window.innerWidth,s=window.innerHeight,u=t.left+t.width/2;d.current.style.transform="";const i=u<r/2?"left":"right";let f=t.top;f=Math.max(10,Math.min(s-t.height-10,f)),T({y:f,side:i})},B=t=>{k(t.clientX,t.clientY)},F=t=>{k(t.touches[0].clientX,t.touches[0].clientY)};n.useEffect(()=>{const t=i=>L(i.clientX,i.clientY),r=()=>a&&M(),s=i=>{a&&i.preventDefault(),L(i.touches[0].clientX,i.touches[0].clientY)},u=()=>a&&M();return a&&(window.addEventListener("mousemove",t),window.addEventListener("mouseup",r),window.addEventListener("touchmove",s,{passive:!1}),window.addEventListener("touchend",u)),()=>{window.removeEventListener("mousemove",t),window.removeEventListener("mouseup",r),window.removeEventListener("touchmove",s),window.removeEventListener("touchend",u)}},[a]);const W=()=>{localStorage.removeItem("nahan_force_perf_hud"),R(!1)};if(!c)return null;const x=y>50,E=j>250,w=p.activeTasks>0||p.processingQueueLength>0||p.storageQueueLength>0,X=!x&&!E,Y={position:"fixed",top:`${l.y}px`,left:l.side==="left"?"0":"auto",right:l.side==="right"?"0":"auto",backgroundColor:x?"rgba(80, 0, 0, 0.95)":"rgba(10, 10, 10, 0.90)",color:"#e5e5e5",padding:"12px",fontSize:"11px",fontFamily:"Menlo, Monaco, Consolas, monospace",zIndex:9999,minWidth:o==="compact"?"auto":"220px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.4)",border:"1px solid rgba(255, 255, 255, 0.1)",backdropFilter:"blur(12px)",display:"flex",flexDirection:"column",gap:"8px",transition:a?"none":"all 0.3s cubic-bezier(0.2, 0.8, 0.2, 1)",borderTopRightRadius:l.side==="left"?"12px":"0",borderBottomRightRadius:l.side==="left"?"12px":"0",borderTopLeftRadius:l.side==="right"?"12px":"0",borderBottomLeftRadius:l.side==="right"?"12px":"0",userSelect:"none",touchAction:"none"},Q={display:"flex",alignItems:"center",justifyContent:"space-between",borderBottom:o==="full"?"1px solid rgba(255, 255, 255, 0.1)":"none",paddingBottom:o==="full"?"8px":"0",marginBottom:o==="full"?"4px":"0"};return e.jsxs("div",{ref:d,"data-testid":`perf-hud-${o}`,style:Y,children:[e.jsxs("div",{style:Q,children:[e.jsxs("div",{onMouseDown:B,onTouchStart:F,style:{display:"flex",alignItems:"center",gap:"6px",cursor:a?"grabbing":"grab",padding:"4px",flex:1},children:[e.jsx(te,{size:14,color:"#666"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",fontWeight:"bold",color:"#fff"},children:[e.jsx(G,{size:14,className:X?"text-green-400":"text-red-400"}),o==="full"&&e.jsx("span",{children:"PERF HUD"})]})]}),e.jsxs("div",{style:{display:"flex",gap:"4px"},children:[e.jsx("button",{onClick:()=>z(o==="full"?"compact":"full"),style:{background:"none",border:"none",color:"#999",cursor:"pointer",padding:"4px"},title:o==="full"?"Compact":"Expand",children:o==="full"?e.jsx(re,{size:14}):e.jsx(K,{size:14})}),e.jsx("button",{onClick:W,style:{background:"none",border:"none",color:"#999",cursor:"pointer",padding:"4px"},title:"Close","data-testid":"perf-hud-close",children:e.jsx(Z,{size:14})})]})]}),o==="compact"&&e.jsxs("div",{style:{display:"flex",gap:"12px",alignItems:"center",fontSize:"12px",paddingLeft:"8px"},children:[e.jsxs("div",{style:{color:h<30?"#ef4444":"#22c55e",fontWeight:"bold"},children:[h," FPS"]}),e.jsxs("div",{style:{color:x?"#ef4444":"#22c55e"},children:["Lag: ",y,"ms"]})]}),o==="full"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"4px 12px"},children:[e.jsx("div",{style:{color:"#888"},children:"FPS"}),e.jsx("div",{style:{color:h<30?"#ef4444":"#22c55e",fontWeight:"bold",textAlign:"right"},children:h}),e.jsx("div",{style:{color:"#888"},children:"Loop Lag"}),e.jsxs("div",{style:{color:x?"#ef4444":"#22c55e",textAlign:"right"},children:[y,"ms"]}),e.jsx("div",{style:{color:"#888"},children:"JS Heap"}),e.jsx("div",{style:{color:E?"#ef4444":"#22c55e",textAlign:"right"},children:j>0?`${j} MB`:"N/A"})]}),e.jsxs("div",{style:{marginTop:"4px",paddingTop:"8px",borderTop:"1px solid rgba(255, 255, 255, 0.1)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[e.jsx("span",{style:{color:"#888"},children:"WORKERS"}),e.jsx("span",{style:{color:w?"#f59e0b":"#22c55e",fontSize:"10px",padding:"2px 6px",borderRadius:"4px",background:w?"rgba(245, 158, 11, 0.1)":"rgba(34, 197, 94, 0.1)"},children:w?"BUSY":"IDLE"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"4px 12px",fontSize:"10px"},children:[e.jsx("div",{style:{color:"#666"},children:"Active Tasks"}),e.jsx("div",{style:{textAlign:"right"},children:p.activeTasks}),e.jsx("div",{style:{color:"#666"},children:"Queue (Proc)"}),e.jsx("div",{style:{textAlign:"right"},children:p.processingQueueLength}),e.jsx("div",{style:{color:"#666"},children:"Queue (Stor)"}),e.jsx("div",{style:{textAlign:"right"},children:p.storageQueueLength})]})]})]})]})};export{se as PerfHUD};
